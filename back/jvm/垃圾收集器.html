<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>垃圾收集器过程 | RuleLau&#39;s Blog</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="/icon.jpg">
    <meta name="description" content="我的个人网站">
    
    <link rel="preload" href="/assets/css/0.styles.99ba71c7.css" as="style"><link rel="preload" href="/assets/js/app.eb78e4ff.js" as="script"><link rel="preload" href="/assets/js/2.062734e7.js" as="script"><link rel="preload" href="/assets/js/31.8c7b7656.js" as="script"><link rel="prefetch" href="/assets/js/10.1fa9c2ce.js"><link rel="prefetch" href="/assets/js/11.b67db8c9.js"><link rel="prefetch" href="/assets/js/12.41340d35.js"><link rel="prefetch" href="/assets/js/13.f7873189.js"><link rel="prefetch" href="/assets/js/14.3a7cc814.js"><link rel="prefetch" href="/assets/js/15.7c3e8bd4.js"><link rel="prefetch" href="/assets/js/16.4d3c2513.js"><link rel="prefetch" href="/assets/js/17.0fce2c50.js"><link rel="prefetch" href="/assets/js/18.0fee2fc2.js"><link rel="prefetch" href="/assets/js/19.cd739ab0.js"><link rel="prefetch" href="/assets/js/20.ccee1235.js"><link rel="prefetch" href="/assets/js/21.3b3ad479.js"><link rel="prefetch" href="/assets/js/22.1a0c7439.js"><link rel="prefetch" href="/assets/js/23.e1875da8.js"><link rel="prefetch" href="/assets/js/24.5428519d.js"><link rel="prefetch" href="/assets/js/25.4be82a8e.js"><link rel="prefetch" href="/assets/js/26.ee5c4ae0.js"><link rel="prefetch" href="/assets/js/27.6f1bb712.js"><link rel="prefetch" href="/assets/js/28.668b830a.js"><link rel="prefetch" href="/assets/js/29.e001ee62.js"><link rel="prefetch" href="/assets/js/3.7c25579e.js"><link rel="prefetch" href="/assets/js/30.14b54e61.js"><link rel="prefetch" href="/assets/js/32.7895a749.js"><link rel="prefetch" href="/assets/js/33.7fdc13eb.js"><link rel="prefetch" href="/assets/js/34.497597fd.js"><link rel="prefetch" href="/assets/js/35.e45ce9de.js"><link rel="prefetch" href="/assets/js/36.dff9db21.js"><link rel="prefetch" href="/assets/js/37.84dca43f.js"><link rel="prefetch" href="/assets/js/38.d35b0106.js"><link rel="prefetch" href="/assets/js/39.cdb3310a.js"><link rel="prefetch" href="/assets/js/4.23425003.js"><link rel="prefetch" href="/assets/js/40.09ef43de.js"><link rel="prefetch" href="/assets/js/41.611a6d59.js"><link rel="prefetch" href="/assets/js/42.67cf3e85.js"><link rel="prefetch" href="/assets/js/43.6327f0de.js"><link rel="prefetch" href="/assets/js/5.cb6c276b.js"><link rel="prefetch" href="/assets/js/6.8acca1fd.js"><link rel="prefetch" href="/assets/js/7.fca05378.js"><link rel="prefetch" href="/assets/js/8.1f37df4a.js"><link rel="prefetch" href="/assets/js/9.f5dc1ff5.js">
    <link rel="stylesheet" href="/assets/css/0.styles.99ba71c7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/icon.jpg" alt="RuleLau's Blog" class="logo"> <span class="site-name can-hide">RuleLau's Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/back/" class="nav-link router-link-active">
  后端
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/back/" class="nav-link router-link-active">
  后端
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>JVM</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/back/jvm/JMM.html" class="sidebar-link">JVM内存结构</a></li><li><a href="/back/jvm/JVMStructure.html" class="sidebar-link">对象的内存布局</a></li><li><a href="/back/jvm/GCAlgorithm.html" class="sidebar-link">垃圾收集策略与算法</a></li><li><a href="/back/jvm/GC.html" class="sidebar-link">垃圾收集器</a></li><li><a href="/back/jvm/MemoryAllocation.html" class="sidebar-link">内存分配与回收策略</a></li><li><a href="/back/jvm/ClassStructure.html" class="sidebar-link">类文件结构</a></li><li><a href="/back/jvm/ClassLoader.html" class="sidebar-link">类加载</a></li><li><a href="/back/jvm/CMS、G1 垃圾收集器中的标记原理.html" class="sidebar-link">CMS、G1 垃圾收集器中的标记原理</a></li><li><a href="/back/jvm/jvm问题.html" class="sidebar-link">jvm 知识点</a></li><li><a href="/back/jvm/垃圾回收机制.html" class="sidebar-link">垃圾回收机制</a></li><li><a href="/back/jvm/垃圾收集器.html" class="active sidebar-link">垃圾收集器过程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/back/jvm/垃圾收集器.html#cms" class="sidebar-link">CMS</a></li><li class="sidebar-sub-header"><a href="/back/jvm/垃圾收集器.html#g1" class="sidebar-link">G1</a></li><li class="sidebar-sub-header"><a href="/back/jvm/垃圾收集器.html#g1触发进入老年代机制" class="sidebar-link">G1触发进入老年代机制</a></li><li class="sidebar-sub-header"><a href="/back/jvm/垃圾收集器.html#触发新生代-老年代的混合垃圾回收机制" class="sidebar-link">触发新生代+老年代的混合垃圾回收机制</a></li><li class="sidebar-sub-header"><a href="/back/jvm/垃圾收集器.html#g1-回收过程" class="sidebar-link">G1 回收过程</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Concurrency</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ThreadPool</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Redis</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>SpringCloud</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Design Pattern</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Distributed-Transaction</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Docker</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Utils</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="垃圾收集器过程"><a href="#垃圾收集器过程" class="header-anchor">#</a> 垃圾收集器过程</h1> <h2 id="cms"><a href="#cms" class="header-anchor">#</a> CMS</h2> <h3 id="初始标记-stw"><a href="#初始标记-stw" class="header-anchor">#</a> 初始标记 (STW)</h3> <ul><li>仅仅只是标记一下GC Roots直接能引用的对象，
这个过程速度是很快，GC Roots：对各个线程栈内存中的局部变量，以及方法区中的类静态变量</li></ul> <h3 id="并发标记"><a href="#并发标记" class="header-anchor">#</a> 并发标记</h3> <ul><li>允许系统程序的运行，同时进行GC Roots追踪，从GC Roots开始追踪所有的存活对象</li></ul> <h3 id="重新标记-stw"><a href="#重新标记-stw" class="header-anchor">#</a> 重新标记 (STW)</h3> <ul><li>系统程序是禁止运行的，但是会根据并发标记阶段记录的那些对象修改，最终标记一下有哪些存活对象，有哪些是垃圾对象</li></ul> <h3 id="并发清理"><a href="#并发清理" class="header-anchor">#</a> 并发清理</h3> <ul><li>并发将上一步标记的对象进行整理在一起，然后一起清除，减少内存碎片</li></ul> <h2 id="g1"><a href="#g1" class="header-anchor">#</a> G1</h2> <h3 id="使用-xx-useg1gc-指定g1垃圾回收器-每个region-的大小为用堆大小除以2048-最多有2048个region-并且region大小为2的倍数"><a href="#使用-xx-useg1gc-指定g1垃圾回收器-每个region-的大小为用堆大小除以2048-最多有2048个region-并且region大小为2的倍数" class="header-anchor">#</a> 使用 “-XX:+UseG1GC”，指定G1垃圾回收器，每个region 的大小为用堆大小除以2048，最多有2048个region，并且region大小为2的倍数</h3> <h3 id="分为新生代和老年代-新生代最多占总比的60-同样也有-eden-和-survivor-区。"><a href="#分为新生代和老年代-新生代最多占总比的60-同样也有-eden-和-survivor-区。" class="header-anchor">#</a> 分为新生代和老年代，新生代最多占总比的60%，同样也有 Eden 和 Survivor 区。</h3> <h3 id="g1-进行年轻代垃圾回收时-可以设置目标gc停顿的时间-通过-xx-maxgcpausemills-默认为200ms"><a href="#g1-进行年轻代垃圾回收时-可以设置目标gc停顿的时间-通过-xx-maxgcpausemills-默认为200ms" class="header-anchor">#</a> G1 进行年轻代垃圾回收时，可以设置目标GC停顿的时间，通过 -XX:MaxGCPauseMills，默认为200ms</h3> <h2 id="g1触发进入老年代机制"><a href="#g1触发进入老年代机制" class="header-anchor">#</a> G1触发进入老年代机制</h2> <h3 id="基本和原来的机制一致-除了大对象进入老年代"><a href="#基本和原来的机制一致-除了大对象进入老年代" class="header-anchor">#</a> 基本和原来的机制一致，除了大对象进入老年代</h3> <h3 id="大对象的判定规则就是一个大对象超过了一个region大小的50-一个对象太大-则会横跨多个region-存放。新生代、老年代在回收的时候-会顺带带着大对象region一起回收"><a href="#大对象的判定规则就是一个大对象超过了一个region大小的50-一个对象太大-则会横跨多个region-存放。新生代、老年代在回收的时候-会顺带带着大对象region一起回收" class="header-anchor">#</a> 大对象的判定规则就是一个大对象超过了一个Region大小的50%，一个对象太大，则会横跨多个Region 存放。新生代、老年代在回收的时候，会顺带带着大对象Region一起回收</h3> <h2 id="触发新生代-老年代的混合垃圾回收机制"><a href="#触发新生代-老年代的混合垃圾回收机制" class="header-anchor">#</a> 触发新生代+老年代的混合垃圾回收机制</h2> <h3 id="老年代占据了堆内存的45-的region的时候-此时就会尝试触发一个新生代-老年代一起回收的混合回收阶段-xx-initiatingheapoccupancypercent-默认值是45"><a href="#老年代占据了堆内存的45-的region的时候-此时就会尝试触发一个新生代-老年代一起回收的混合回收阶段-xx-initiatingheapoccupancypercent-默认值是45" class="header-anchor">#</a> 老年代占据了堆内存的45%的Region的时候，此时就会尝试触发一个新生代+老年代一起回收的混合回收阶段，-XX:InitiatingHeapOccupancyPercent，默认值是45%</h3> <h2 id="g1-回收过程"><a href="#g1-回收过程" class="header-anchor">#</a> G1 回收过程</h2> <h3 id="初始标记-stw-2"><a href="#初始标记-stw-2" class="header-anchor">#</a> 初始标记 (STW)</h3> <ul><li>仅仅只是标记一下GC Roots直接能引用的对象，
这个过程速度是很快，GC Roots：对各个线程栈内存中的局部变量，以及方法区中的类静态变量</li></ul> <h3 id="并发标记-耗时-会追踪全部对象"><a href="#并发标记-耗时-会追踪全部对象" class="header-anchor">#</a> 并发标记（耗时，会追踪全部对象）</h3> <ul><li>允许系统程序的运行，同时进行GC Roots追踪，从GC Roots开始追踪所有的存活对象</li></ul> <h3 id="最终标记-stw"><a href="#最终标记-stw" class="header-anchor">#</a> 最终标记 (STW)</h3> <ul><li>系统程序是禁止运行的，但是会根据并发标记阶段记录的那些对象修改，最终标记一下有哪些存活对象，有哪些是垃圾对象</li></ul> <h3 id="混合回收-stw"><a href="#混合回收-stw" class="header-anchor">#</a> 混合回收(STW)</h3> <ul><li><p>计算老年代中每个Region中的存活对象数量，存活对象的占比，还有执行垃圾回收的预期性能和效率。接着会停止系统程序，然后全力以赴尽快进行垃圾回收，此时会选择部分Region进行回收，因为必须让垃圾回收的停顿时间控制在指定的范围内</p> <ul><li>是允许执行多次混合回收,“-XX:G1MixedGCCountTarget”参数，就是在一次混合回收的过程中，最后一个阶段执行几次混合回收，默认值是8次。一旦空闲出来的Region数量达到了堆内存的5%，此时就会 立即停止混合回收，“-XX:G1HeapWastePercent”，默认值是5%“-XX:G1MixedGCLiveThresholdPercent”，默认值是85%，意思就是确定要回收的Region的时候，必须是存活对象低于85%的Region才可以进行回收</li></ul></li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2021/1/29 上午7:42:17</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/back/jvm/垃圾回收机制.html" class="prev">
        垃圾回收机制
      </a></span> <span class="next"><a href="/back/concurrency/Volatile.html">
        volatile
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.eb78e4ff.js" defer></script><script src="/assets/js/2.062734e7.js" defer></script><script src="/assets/js/31.8c7b7656.js" defer></script>
  </body>
</html>
